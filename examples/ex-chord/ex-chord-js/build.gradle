apply plugin: 'com.moowork.node'
apply plugin: 'kotlin-dce-js'

dependencies {
    expectedBy project(":ex-chord-common")
    compile project(":d2v-chord-common")
    compile project(":d2v-chord-js")
    compile project(":d2v-data2viz-js")
}


task copyDependencies(type: Copy, dependsOn: compileKotlin2Js) {

    from compileKotlin2Js.destinationDir

    configurations.testCompile.each {
        from zipTree(it.absolutePath).matching { include '*.js' }
    }

    into "${buildDir}/dist"
}

task yarnInstall(type: YarnTask) {
    args = ['install']
}

task bundle(type: YarnTask, dependsOn: [runDceKotlinJs, yarnInstall]) {
    args = ["run", "bundle"]
}

afterEvaluate {
    if (tasks.findByName('unpackDependenciesTestKotlinJs')) {
        tasks.unpackDependenciesTestKotlinJs.enabled = false
    }
}

build.dependsOn copyDependencies
